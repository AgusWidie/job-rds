@using WebDms.Help
@model WebDms.ViewModels.BrowserVM;
@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_LayoutDms.cshtml";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
        </div><!-- /.container-fluid -->
    </section>
    <!-- /.content-header -->
    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <div class="row my-flex-card">
                <div class="col-lg-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Favorite</h3>
                        </div>
                        <!-- /.card-header -->
                        <div class="card-body">
                            <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                                <li class="nav-item">
                                    <a asp-controller="DocumentTypes" asp-action="Index" class="nav-link">
                                        <i class="nav-icon fa fa-object-ungroup"></i>
                                        <p class="text">Document Types</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a asp-controller="Collections" asp-action="Index" class="nav-link">
                                        <i class="nav-icon fa fa-object-group"></i>
                                        <p class="text">Collections</p>
                                    </a>
                                </li>
                            </ul>
                            <hr />
                            <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">

                                <li class="nav-item">
                                    <a asp-controller="Home" asp-action="Favorite" asp-route-id="1" class="nav-link">
                                        <i class="nav-icon far fa-star"></i>
                                        <p class="text">Favorites</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a asp-controller="Home" asp-action="Share" asp-route-id="1" class="nav-link">
                                        <i class="nav-icon fas fa-share-alt"></i>
                                        <p class="text">Share</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a asp-controller="Home" asp-action="Delete" asp-route-id="1" class="nav-link">
                                        <i class="nav-icon far fa-trash-alt"></i>
                                        <p class="text">Trash</p>
                                    </a>
                                </li>
                            </ul>
                            <hr />
                            <div class="panel panel-info">
                                <div class="panel-heading">
                                    Collection Folders
                                </div>
                                <div class="panel-body">
                                    <div id="html1">
                                    </div>
                                </div>
                            </div>

                            <!-- /.tree -->
                        </div>
                        <!-- /.card-body -->
                    </div>
                    <!-- /.card -->
                </div>
                <!-- /.col-lg-2 -->
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="form-group clearfix">
                                       
                                        @* <button type="button" class="btn btn-outline-info" onclick="AddUploadFile();"><i class="fa fa-upload"></i> Upload</button>
                                        <button type="button" class="btn btn-outline-info" data-toggle="modal" data-target="#createFolderModal"><i class="fa fa-folder"></i> Create Folder</button> *@
                                    </div>
                                </div>
                                <div class="col-sm-8">
                                    <form method="get" asp-controller="Home" asp-action="Favorite">
                                        <input type="hidden" id="FDirectoryIdDoc" name="id"/>

                                        <table id="frmOptions" style="float:right;">

                                            <td style="width: 250px;">
                                                <div class="form-group">
                                                    <label for="documenttype">Document Types</label>
                                                    <select id="fDocumentTypeId" name="document_type_id" asp-items="(IEnumerable<SelectListItem>)@ViewBag.lstDocTypes" class="form-control" onchange="onChangeDocumentTypeIndex();"></select>
                                                </div>
                                            </td>
                                            <div>
                                                <td style="width: 250px;" id="docIndex" hidden>
                                                    <div class="form-group">
                                                        <label for="documentindex">Document Index</label>
                                                        <select id="fDocumentIndexId" name="document_index_id" class="form-control" style="font-size: 16px;" onchange="onChangeDocumentIndex();"></select>
                                                    </div>
                                                </td>
                                                <td style="width: 250px;" id="docIndexValue" hidden>
                                                    <div class="form-group">
                                                        <label for="indexvalue">Index Value</label>
                                                        <input type="text" id="fDocumentIndexValue" name="document_index_value" class="form-control">
                                                    </div>
                                                </td>
                                                <td id="docIndexSearch" hidden>
                                                    <div class="form-group">
                                                        <button type="submit" title="Search" class="btn btn-sm btn-outline-info" style="margin-top: 33px; height: 38px;"><i class="fa fa-search" aria-hidden="true"></i></button>
                                                    </div>
                                                </td>
                                                <td id="docIndexRefresh">
                                                    <div class="form-group">
                                                        <button type="button" title="Refresh" class="btn btn-sm btn-outline-info" onclick="onChangeRefresh();" style="margin-top: 33px; height: 38px;"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                                                    </div>
                                                </td>
                                            </div>
                                        </table>
                                    </form>
                                    
                                </div>
                            </div>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Library</li>
                                </ol>
                            </nav>

                        </div>
                        <!-- /.card-header -->

                        <div class="card-body">
                            <div id="example2_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                <div class="row">
                                    <div class="col-sm-12">
                                        <table id="example2" class="table table-hover dataTable dtr-inline" aria-describedby="example2_info">
                                            <tr>
                                                <th>#</th>
                                                <th>DOCUMENT NAME</th>
                                                <th>DOCUMENT NO</th>
                                                <th>DATE VERSION</th>
                                                <th>EXPIRED DATE</th>
                                                <th>CREATED AT</th>
                                                <th style="text-align: center;">ACTION</th>
                                            </tr>
                                            @if (Model.documents != null)
                                            {

                                                @foreach (var item in Model.documents)
                                                {
                                                    string created_at = "";
                                                    string updated_at = "";
                                                    string date_version = "";
                                                    string download_date = "";
                                                    string expired_date = "";

                                                    if (item.created_at != null)
                                                    {
                                                        created_at = item.created_at.ToString("yyyy-MM-dd HH:mm:ss");
                                                    }

                                                    if (item.updated_at != null)
                                                    {
                                                        updated_at = Convert.ToDateTime(item.updated_at).ToString("yyyy-MM-ddy HH:mm:ss");
                                                    }

                                                    if (item.date_version != null)
                                                    {
                                                        date_version = Convert.ToDateTime(item.date_version).ToString("yyyy-MM-dd");
                                                    }

                                                    if (item.download_date != null)
                                                    {
                                                        download_date = Convert.ToDateTime(item.download_date).ToString("yyyy-MM-dd HH:mm:ss");
                                                    }

                                                    if (item.expired_date != null)
                                                    {
                                                        expired_date = Convert.ToDateTime(item.expired_date).ToString("yyyy-MM-dd");
                                                    }

                                                    //byte[] fileBytes = System.IO.File.ReadAllBytes(item.file_path);

                                                    <tr onclick="ViewFileInfo('@item.file_name','@item.file_path','@item.extension','@date_version','@created_at','@updated_at','@Convert.ToBase64String(@Crypto.DecryptSha256(@item.encrypt_file))','@item.content_type','@download_date','@String.Format("{0:C}", item.file_size).Replace("$","")')">
                                                        <td class="mailbox-star" style="text-align: center; vertical-align: middle;">
                                                            @if (item.favorite == true) {
                                                                <a href="#"><i class="fas fa-star text-warning"></i></a>
                                                            } else {
                                                                <a href="#"><i class="fas fa-star"></i></a>
                                                            }
                                                        </td>
                                                        <td class="products-list product-list-in-card pl-2 pr-2">
                                                            <div class="item">
                                                                <div class="product-img">
                                                                    @if (item.extension == ".jpeg")
                                                                    {
                                                                        <img src="~/dist/img/image.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".png")
                                                                    {
                                                                        <img src="~/dist/img/image.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".xlsx")
                                                                    {
                                                                        <img src="~/dist/img/xlsx.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".xls")
                                                                    {
                                                                        <img src="~/dist/img/xls.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".pdf")
                                                                    {
                                                                        <img src="~/dist/img/pdf.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".docx")
                                                                    {
                                                                        <img src="~/dist/img/doc.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".rar")
                                                                    {
                                                                        <img src="~/dist/img/zip.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".zip")
                                                                    {
                                                                        <img src="~/dist/img/xlsx.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else if (item.extension == ".txt")
                                                                    {
                                                                        <img src="~/dist/img/txt.png" alt="Product Image" class="img-size-50">
                                                                    }
                                                                    else
                                                                    {
                                                                        <img src="~/dist/img/undefine.png" alt="Product Image" class="img-size-50">
                                                                    }

                                                                </div>
                                                                <div class="product-info">
                                                                    <a href="javascript:void(0)" onclick="fileDescription(@item.id)" class="product-title">
                                                                    <div class="" style="margin-top: 22px;">
                                                                         @item.file_name
                                                                    </div>
                                                                       
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td style="vertical-align: middle;" class="products-list product-list-in-card pl-2 pr-2">
                                                            <div class="" style="margin-top: 22px;">
                                                                @item.document_no
                                                            </div>
                                                        </td>
                                                        <td style="vertical-align: middle;" class="products-list">
                                                            <div class="" style="margin-top: 22px;">
                                                                @Convert.ToDateTime(@item.date_version).ToString("dd-MM-yyyy")
                                                            </div>
                                                        </td>
                                                        <td style="vertical-align: middle;" class="products-list">
                                                            <div class="" style="margin-top: 22px;">
                                                                @Convert.ToDateTime(@item.expired_date).ToString("dd-MM-yyyy")
                                                            </div>
                                                        </td>
                                                        <td style="vertical-align: middle;" class="products-list">
                                                            <div class="" style="margin-top: 22px;">
                                                                @Convert.ToDateTime(@item.created_at).ToString("dd-MM-yyyy")
                                                            </div>
                                                        </td>
                                                        <td style="text-align: center;">
                                                            <div class="" style="margin-top: 22px;">
                                                                <button type="button" title="Restore File" class="btn btn-sm btn-outline-info" onclick="RestoreFileFavorite('@item.id','@item.document_id','@item.document_name');"><i class="fa fa-reply"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                }
                                            }

                                        </table>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-5">
                                        <div class="dataTables_info" id="example2_info" role="status" aria-live="polite">Showing 1 to 10 of 57 entries</div>
                                    </div>
                                    <div class="col-sm-12 col-md-7">
                                        <div class="dataTables_paginate paging_simple_numbers" id="example2_paginate">
                                            <ul class="pagination">
                                                <li class="paginate_button page-item previous disabled" id="example2_previous">
                                                    <a href="#" aria-controls="example2" data-dt-idx="0" tabindex="0" class="page-link">Previous</a>
                                                </li>
                                                <li class="paginate_button page-item active">
                                                    <a href="#" aria-controls="example2" data-dt-idx="1" tabindex="0" class="page-link">1</a>
                                                </li>
                                                <li class="paginate_button page-item "><a href="#" aria-controls="example2" data-dt-idx="2" tabindex="0" class="page-link">2</a></li>
                                                <li class="paginate_button page-item "><a href="#" aria-controls="example2" data-dt-idx="3" tabindex="0" class="page-link">3</a></li>
                                                <li class="paginate_button page-item "><a href="#" aria-controls="example2" data-dt-idx="4" tabindex="0" class="page-link">4</a></li>
                                                <li class="paginate_button page-item "><a href="#" aria-controls="example2" data-dt-idx="5" tabindex="0" class="page-link">5</a></li>
                                                <li class="paginate_button page-item "><a href="#" aria-controls="example2" data-dt-idx="6" tabindex="0" class="page-link">6</a></li>
                                                <li class="paginate_button page-item next" id="example2_next"><a href="#" aria-controls="example2" data-dt-idx="7" tabindex="0" class="page-link">Next</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-8 -->

                <div class="col-lg-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">File Information</h3>
                        </div>
                        <!-- /.card-header -->
                        <div class="card-body">

                            <div class="text-center">
                                @* <img src="~/dist/img/user1-128x128.jpg" alt="user-avatar" class="img img-fluid"> *@
                                <img id="ImageFile" style="height: 100px; width: 120px;" class="img img-fluid">
                            </div>
                            <hr />

                            @*<div class="col-7">
                            <p class="text-muted text-sm"><b>File: </b> Guest.jpeg </p>
                            <p class="text-muted text-sm"><b>Size: </b> 10 Mb </p>

                            </div>*@

                            <div class="row mt-4">
                                <nav class="w-100">
                                    <div class="nav nav-tabs" id="product-tab" role="tablist">
                                        <a class="nav-item nav-link active" id="product-desc-tab" data-toggle="tab" href="#product-desc" role="tab" aria-controls="product-desc" aria-selected="true">Description</a>
                                        <a class="nav-item nav-link" id="product-comments-tab" data-toggle="tab" href="#product-comments" role="tab" aria-controls="product-comments" aria-selected="false">Share</a>
                                        <a class="nav-item nav-link" id="product-rating-tab" data-toggle="tab" href="#product-rating" role="tab" aria-controls="product-rating" aria-selected="false">Tag</a>
                                        <a class="nav-item nav-link" id="product-log-tab" data-toggle="tab" href="#product-log" role="tab" aria-controls="product-log" aria-selected="false">Log</a>
                                    </div>
                                </nav>
                                <div class="tab-content p-3" id="nav-tabContent">
                                    <div class="tab-pane fade show active" id="product-desc" role="tabpanel" aria-labelledby="product-desc-tab">

                                        <strong class="text-muted"><i class="fas fa-file-alt mr-1"></i> Document Name</strong>
                                        <p id="FileName" class="text-muted"></p>

                                        <strong class="text-muted"><i class="fas fa-file-alt mr-1"></i> Size</strong>
                                        <p id="FileSize" class="text-muted"></p>

                                        <strong class="text-muted"><i class="fa fa-server mr-1"></i> Date Version</strong>
                                        <p id="DateVersion" class="text-muted"></p>

                                        <strong class="text-muted"><i class="fas fa-file-upload mr-1"></i> Upload</strong>
                                        <p id="CreatedDate" class="text-muted"></p>

                                        <strong class="text-muted"><i class="fas fa-file-download mr-1"></i> Download</strong>
                                        <p id="UpdatedDate" class="text-muted"></p>

                                    </div>
                                    <div class="tab-pane fade" id="product-comments" role="tabpanel" aria-labelledby="product-comments-tab">
                                        <ul class="products-list product-list-in-card pl-2 pr-2 w-100">
                                            <li class="item">
                                                <div class="product-img">
                                                    <img src="~/dist/img/user1-128x128.jpg" alt="Product Image" class="img-circle img-bordered-sm">
                                                </div>
                                                <div class="product-info">
                                                    <a href="javascript:void(0)" class="product-title">
                                                        Sarah
                                                        <span class="badge badge-warning float-right">Unshared</span>
                                                    </a>
                                                    <span class="product-description">
                                                        @DateTime.Now
                                                    </span>
                                                </div>
                                            </li>

                                            <li class="item">
                                                <div class="product-img">
                                                    <img src="~/dist/img/user2-160x160.jpg" alt="Product Image" class="img-circle img-bordered-sm">
                                                </div>
                                                <div class="product-info">
                                                    <a href="javascript:void(0)" class="product-title">
                                                        Adam
                                                        <span class="badge badge-info float-right">Unshared</span>
                                                    </a>
                                                    <span class="product-description">
                                                        @DateTime.Now
                                                    </span>
                                                </div>
                                            </li>

                                            <li class="item">
                                                <div class="product-img">
                                                    <img src="~/dist/img/user6-128x128.jpg" alt="Product Image" class="img-circle img-bordered-sm">
                                                </div>
                                                <div class="product-info">
                                                    <a href="javascript:void(0)" class="product-title">
                                                        Nero
                                                        <span class="badge badge-danger float-right">
                                                            Unshared
                                                        </span>
                                                    </a>
                                                    <span class="product-description">
                                                        @DateTime.Now
                                                    </span>
                                                </div>
                                            </li>

                                            <li class="item">
                                                <div class="product-img">
                                                    <img src="~/dist/img/user7-128x128.jpg" alt="Product Image" class="img-circle img-bordered-sm">
                                                </div>
                                                <div class="product-info">
                                                    <a href="javascript:void(0)" class="product-title">
                                                        Modotz
                                                        <span class="badge badge-success float-right">Unshared</span>
                                                    </a>
                                                    <span class="product-description">
                                                        @DateTime.Now
                                                    </span>
                                                </div>
                                            </li>

                                        </ul>

                                    </div>
                                    <div class="tab-pane fade" id="product-rating" role="tabpanel" aria-labelledby="product-rating-tab">
                                        <span class="tag label label-info">
                                            <span>Example Tag</span>
                                            <a><i class="remove glyphicon glyphicon-remove-sign glyphicon-white"></i></a>
                                        </span>
                                        <span class="badge badge-success">Ganteng</span>
                                        <span class="badge badge-success">Pandai</span>
                                    </div>
                                    <div class="tab-pane fade" id="product-log" role="tabpanel" aria-labelledby="product-log-tab">
                                    </div>
                                </div>
                            </div>
                            <!-- /.tree -->
                        </div>
                        <!-- /.card-body -->
                    </div>
                    <!-- /.card -->
                </div>
                <!-- /.col-lg-2 -->
            </div>
            <!-- /.row -->
        </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
    
    <link href="~/content/select2.min.css" rel="stylesheet">
    <script src="~/content/select2.min.js"></script>

    <link href="~/content/select2/select2-bootstrap.css" rel="stylesheet">
    <link href="~/content/select2/select2.min.css" rel="stylesheet">
    <script src="~/content/select2/select2.full.js"></script>

    <link href="~/adminlte/plugins/sweetalert2/sweetalert2.min.css" rel="stylesheet">
    <script src="~/adminlte/plugins/sweetalert2/sweetalert2.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf_viewer.min.css" rel="stylesheet" type="text/css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

    <script>

     
        // $(function () {
        //     let tree = '';
        //     var collId = '@ViewBag.collId';
        //     var dirId = '@ViewBag.dirId';

        //     console.log('collId:', collId);
        //     console.log('dirId:', dirId);

        //     $('#CollectionId').val(collId);
        //     $('#ParentId').val(dirId);
        //     $('#DirectoryId').val(dirId);
        //     $('#FDirectoryId').val(dirId);
        //     $('#FCollectionId').val(collId);
        //     $('#FDirectoryIdDoc').val(dirId);

        //     $('#html1').jstree({
        //         'core': {
        //             'data': {
        //                 'url': '/Home/Folders?id=' + collId + '&idx=' + dirId,
        //                 //'data': function (node) {
        //                 //    return { 'id': node.id };
        //                 //},
        //                 'dataFilter': function (data) {
        //                     // process the data any way you want (console.log(data) to see what you have, transform it and return the new object)
        //                     // keep in mind for some jQuery versions (older ones) you will have to return a string and not an object - if that is the case "return JSON.stringify(new_data);" will do
        //                     // console.log('data:',data);



        //                     var datas = jQuery.parseJSON(data)
        //                     //console.log(datas);
        //                     for (let i = 0; i < datas.length; i++) {
        //                         console.log('datas:', datas[i]);
        //                         if (datas[i].id == dirId) {
        //                             //console.log('tree:',datas[i].tree);
        //                             tree = datas[i].tree;
        //                         }
        //                     }

        //                     return data;
        //                 }
        //             }
        //         }
        //     });

        //     $('#html1').on('changed.jstree', function (e, data) {
        //         console.log(data);
        //         //console.log('selected:',data.selected[0]);
        //         var id = data.selected[0];
        //         location.href = "/Home/Dir/" + id;

        //         var i, j, r = [];
        //         for (i = 0, j = data.selected.length; i < j; i++) {
        //             r.push(data.instance.get_node(data.selected[i]).text);
        //         }
        //         // alert('Selected: ' + r.join(', '));
        //         // $('#event_result').html('Selected: ' + r.join(', '));

        //     }).jstree();

        //     $('#html1').bind('ready.jstree', function (e, data) {
        //         var $tree = $(this);

        //         // untuk membuka tree yang aktif
        //         const parents = tree.split(",");
        //         for (let i = 0; i < parents.length; i++) {
        //             $tree.jstree().open_node({ "id": parents[i] });
        //         }
        //     });

        // });

        // function fileDescription(id) {
        //     console.log('item:', id);
        //     $.get("http://localhost:5285/Browser/FileInfo/" + id, {
        //     },
        //         function (response, status) {
        //             console.log(response);
        //             console.log(response.fileName);
        //             $('#fileName').text(response.file_name);
        //             //$('#pTest').text('test');
        //             //$('#pTest').text('test');
        //             $('#createdDate').text(response.created_date);
        //         }
        //     );
        // }

        
        SetValueForSelect2("fDocumentTypeId","@TempData["fDocumentTypeId"]");
        document.getElementById("fDocumentIndexValue").value = "@TempData["fDocumentIndexValue"]";

        $("#fDocumentTypeId").select2({
            placeholder: "",
            width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
        });

        $("#fDocumentIndexId").select2({
            placeholder: "",
            width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
        });

      
        function SetValueForSelect2(SelectId, Value) {
            $("#" + SelectId).val(Value).trigger("change");

        }

        function ViewFileInfo(FileName, FilePath, Extention, DateVersion, CreatedDate, UpdatedDate, FileDecrypt, ContntType, DownloadDate, FileSize) {

            document.getElementById("FileName").innerHTML = FileName;
            document.getElementById("FileSize").innerHTML = FileSize;
            document.getElementById("DateVersion").innerHTML = DateVersion;
            document.getElementById("CreatedDate").innerHTML = CreatedDate;
            document.getElementById("UpdatedDate").innerHTML = DownloadDate;

            if (Extention == ".jpeg")
            {
                 document.getElementById("ImageFile").src = "data:" + ContntType + ";base64," + FileDecrypt;
            }
            else if (Extention == ".png")
            {
                 document.getElementById("ImageFile").src = "data:" + ContntType + ";base64," + FileDecrypt;
            }
            else if (Extention == ".xlsx")
            {
                document.getElementById("ImageFile").src = "/dist/img/xlsx.png";
            }
            else if (Extention == ".xls")
            {
                 document.getElementById("ImageFile").src = "/dist/img/xls.png";
            }
            else if (Extention == ".pdf")
            {
                document.getElementById("ImageFile").src = "/dist/img/pdf.png";
            }
            else if (Extention == ".docx")
            {
                document.getElementById("ImageFile").src = "/dist/img/doc.png";
            }
            else if (Extention == ".rar")
            {
                document.getElementById("ImageFile").src = "/dist/img/zip.png";
            }
            else if (Extention == ".zip")
            {
                document.getElementById("ImageFile").src = "/dist/img/zip.png";
            }
            else if (Extention == ".txt")
            {
                 document.getElementById("ImageFile").src = "/dist/img/txt.png";
            }
            else
            {
                document.getElementById("ImageFile").src = "data:" + ContntType + ";base64," + FileDecrypt;
            }

        }

        function PreviewFile(Id, Extention)
        {

            $.ajax({
                type: "GET",
                url: "@Url.Action("PreviewFile", "Home")",
                data: { id: Id},
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    //alert(JSON.stringify(data));

                    openFile(data.encrypt_file, data.content_type, Extention);
                },
                error: function (error) { },
            });
        }

        function onChangeDocumentTypeIndex() {

            var document_type_id = document.getElementById("fDocumentTypeId").value;

            if(document_type_id != "" && document_type_id != null) {
                document.getElementById("docIndex").hidden = false;
                document.getElementById("docIndexValue").hidden = false;
                document.getElementById("docIndexSearch").hidden = false;
            } else {
                document.getElementById("docIndex").hidden = true;
                document.getElementById("docIndexValue").hidden = true;
                document.getElementById("docIndexSearch").hidden = true;
            }

            $.ajax({
                type: "GET",
                url: "@Url.Action("GetIndexDocType", "DocumentIndex")",
                data: {
                            DocumentTypeId: document_type_id
                      },
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    if(data.error == false) {

                        $('#fDocumentIndexId').empty().append('<option selected="selected" value=""></option>');
                        var dataJSON = data.res;
                        dataJSON.forEach(data =>
                        {
                           $('#fDocumentIndexId').append('<option value="' + data.index_id + '">' + data.index_name + '</option>');

                        });

                        SetValueForSelect2("fDocumentIndexId","@TempData["fDocumentIndexId"]");
                    }

                },
                error: function (xhr, status, error) {
                    var err = JSON.parse(xhr.responseText);
                    console.log("onChangeDocumentTypeIndex : " + err);

                }
            });
        }

        function onChangeDocumentIndex() {
            var document_type_id = document.getElementById("fDocumentTypeId").value;
            var document_index_id = document.getElementById("fDocumentIndexId").value;

            $.ajax({
                type: "GET",
                url: "@Url.Action("GetIndex", "DocumentIndex")",
                data: {
                            DocumentTypeId: document_type_id,
                            DocumentIndexId: document_index_id
                      },
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    if(data.error == false) {

                        var dataJSON = data.res;
                        dataJSON.forEach(data =>
                        {
                           var rules = JSON.parse(data.rules);
                           if(rules.type == "Text") {
                               document.getElementById("fDocumentIndexValue").type = "text";
                           }

                           if(rules.type == "Number") {
                               document.getElementById("fDocumentIndexValue").type = "number";
                           }

                           if(rules.type == "Date") {
                               document.getElementById("fDocumentIndexValue").type = "date";
                           }

                        });


                    }

                },
                error: function (xhr, status, error) {
                    var err = JSON.parse(xhr.responseText);
                    console.log("onChangeDocumentTypeIndex : " + err);

                }
            });
        }

        function openFile(base64, content_type, extention) {

            const arrayBuffer = base64ToArrayBuffer(base64);
            const blob = new Blob([arrayBuffer], { type: '' + content_type + ''});
            const url = window.URL.createObjectURL(blob);

            //window.open(url, 'width=1024,height=768,resizable=yes,scrollbars=yes,toolbar=no,location=no,directories=no,status=no,menubar=no,copyhistory=no');
            LoadPdfFromUrl(url);

            $('#PreviewFilePDF').modal({
                backdrop: 'static',
                keyboard: false
            });
            $('#PreviewFilePDF').modal('show');
            
        }

        function base64ToArrayBuffer(base64) {

            const binaryString =  window.atob(base64);
            const binaryLen = binaryString.length;
            const bytes = new Uint8Array(binaryLen);
            for (let i = 0; i < binaryLen; i++)        {
                const ascii = binaryString.charCodeAt(i);
                bytes[i] = ascii;
            }
            return bytes;
        }

        function RestoreFileFavorite(id, document_id, document_name) {
            Swal.fire({
                  title: "Are you sure?",
                  text: "You won't restore favorite document : " + document_name + "",
                  icon: "warning",
                  showCancelButton: true,
                  confirmButtonColor: "#3085d6",
                  cancelButtonColor: "#d33",
                  confirmButtonText: "Yes, restore it!"

            }).then((result) => {

                if (result.isConfirmed) {
                    var data = {

                        id: parseInt(id),
                        document_id: document_id,
                        document_name: document_name
                    };

                    var stringData = JSON.stringify(data);

                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("UpdateRestoreFavorite", "Home")",
                        data: stringData,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            if (data.error === false) {

                                Swal.fire({
                                      title: "Update !",
                                      text: "Your file has been restore favorite.",
                                      icon: "success"
                                });

                                var actionUrl = '@Url.Action("Favorite", "Home", new { id = "PLACEHOLDER1" })';
                                actionUrl = actionUrl.replace('PLACEHOLDER1', directory_id);
                                window.location.href = actionUrl.replaceAll('amp;', "");
                            }
                            else {

                                Swal.fire({
                                      title: "Error !",
                                      text: "" + data.message + "",
                                      icon: "danger"
                                });

                                var actionUrl = '@Url.Action("Favorite", "Home", new { id = "PLACEHOLDER1" })';
                                actionUrl = actionUrl.replace('PLACEHOLDER1', directory_id);
                                window.location.href = actionUrl.replaceAll('amp;', "");
                            }
                        },
                        error: function (error) { },
                    });
                }
            });
        
        }

        var pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js';

        var pdfDoc = null;
        var scale = 1.8; //Set Scale for zooming PDF.
        var resolution = 1; //Set Resolution to Adjust PDF clarity.

        function LoadPdfFromUrl(url) {

            while (pdf_container.hasChildNodes()) {
                   pdf_container.removeChild(pdf_container.firstChild);
            }
            //Read PDF from URL.
            pdfjsLib.getDocument(url).promise.then(function (pdfDoc_) {
                pdfDoc = pdfDoc_;

                //Reference the Container DIV.
                var pdf_container = document.getElementById("pdf_container");
                pdf_container.style.display = "block";

                //Loop and render all pages.
                for (var i = 1; i <= pdfDoc.numPages; i++) {
                    RenderPage(pdf_container, i);
                }
            });
        };

        function RenderPage(pdf_container, num) {
            pdfDoc.getPage(num).then(function (page) {
                //Create Canvas element and append to the Container DIV.
                var canvas = document.createElement('canvas');
                canvas.id = 'pdf-' + num;
                ctx = canvas.getContext('2d');
                pdf_container.appendChild(canvas);

                //Create and add empty DIV to add SPACE between pages.
                var spacer = document.createElement("div");
                spacer.style.height = "25px";
                spacer.style.width = "600px";
                pdf_container.appendChild(spacer);

                //Set the Canvas dimensions using ViewPort and Scale.
                var viewport = page.getViewport({ scale: scale });
                canvas.height = resolution * viewport.height;
                canvas.width = resolution * viewport.width;

                //Render the PDF page.
                var renderContext = {
                    canvasContext: ctx,
                    viewport: viewport,
                    transform: [resolution, 0, 0, resolution, 0, 0]
                };

                page.render(renderContext);
            });
        };

        function onChangeRefresh() {

            var id = document.getElementById("FDirectoryIdDoc").value;
            var actionUrl = '@Url.Action("Favorite", "Home", new { id = "PLACEHOLDER1" })';
            actionUrl = actionUrl.replace('PLACEHOLDER1', id);
            window.location.href = actionUrl.replaceAll('amp;', "");
        }
       
    </script>
</div>
<!-- /.content-wrapper -->
